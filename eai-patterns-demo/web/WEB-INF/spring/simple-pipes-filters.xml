<?xml version="1.0" encoding="UTF-8"?>
<beans:beans xmlns="http://www.springframework.org/schema/integration"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xmlns:beans="http://www.springframework.org/schema/beans"
             xsi:schemaLocation="http://www.springframework.org/schema/beans
                  http://www.springframework.org/schema/beans/spring-beans.xsd
                  http://www.springframework.org/schema/integration
                  http://www.springframework.org/schema/integration/spring-integration.xsd">


    <inbound-channel-adapter channel="sample-channel" />

    <channel id="sample-channel"/>

    <!-- sample filter: skip orders without order number -->
    <filter id="sample-filter" input-channel="sample-channel" output-channel="matching-msg-channel"
            discard-channel="non-matching-msg-channel" expression="payload['ORDER_NUMBER'] > 0"/>

    <channel id="matching-msg-channel"/>

    <outbound-channel-adapter id="custom-adapter" channel="matching-msg-channel" ref="receiver" method="sendData"/>

    <beans:bean id="receiver" class="com.github.aheusingfeld.javaone2012.eai.MyExternalSystemAdapter"/>


    <channel id="non-matching-msg-channel"/>

    <!-- this would usually be a dead-letter-queue, for reasons of brevity we simply write the message to the logfile -->
    <logging-channel-adapter channel="non-matching-msg-channel" log-full-message="true"/>

</beans:beans>
